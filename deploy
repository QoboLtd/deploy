#!/usr/bin/php
<?php
/**
 * Deploy
 * 
 * Deployment automation framework
 * 
 * @author Leonid Mamchenkov <l.mamchenkov@qobo.biz>
 */
namespace Deploy;
use \Deploy\Config\Factory;
use \Deploy\Runnable\Project;
// Load libraries
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'vendor' . DIRECTORY_SEPARATOR . 'autoload.php';
require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'lib' . DIRECTORY_SEPARATOR . 'Deploy' . DIRECTORY_SEPARATOR . 'autoload.php';

// We keep all configuration files in etc/ folder
$configFolder = dirname(__FILE__) . DIRECTORY_SEPARATOR . 'etc' . DIRECTORY_SEPARATOR;

array_shift($argv);
// These are the things we need to know
if (count($argv) <> 3) {
	print "\nUsage: ./deploy PROJECT ENVIRONMENT COMMAND\n\n";
	die();
}

$target = array();
$target['project'] = array($argv[0]);
$target['environment'] = array($argv[1]);
$target['command'] = array($argv[2]);

try {
	$config = Factory::init(new \splFileInfo($target['project'][0]));
	$config = $config->data;
	$config['_target'] = $target;

	$project = new Project($config);
	$project->run();
} catch (Exception $e) {
	die("\n\nERROR: " . $e->getMessage() . "\n");
}
?>
